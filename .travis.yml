dist: trusty
language: rust
sudo: false

rust:
  - stable

env:
  global:
    - TARGET=snowchains
    - RUST_BACKTRACE=full
    - secure: "kQ5olHintZYnylyxgDjN2vN9BNxoFjO2yJMcmKLpxL0ij7ygSe4xaOQKIxgHhaXRHUVZE2zKGMO7g0x6t8igOYRVYjVn7UpMxvVS/GdsicLGpYr5M390nzxrSnmc0cqKhYIgLkyyR72g6o4y+O5C0x8m8+/KdVVqxvAuZ4uo/6df7OTKPJLWHJs7Gp3P38GAb14qe4FHFO7o1MbnsrbuX877Pv/p6Iv9wpEVf/RWshPWiJiFTmKEPhJ8GkgJAU1Mn+VZTBtFLu+H5gl7xcp9T+Wr6sy/RuDN9mGA+PevkUIBgI8CNsvO38+1yEMGqQNxAASIHLEtczWOjQS5PhXr3cuxDTUS8HnreXNezMJGWRFKh5DyIa4RlUv98c4mbXe5nAJopPlHrB/leO2WzaTq3MSmls40QzrgkQhofGJC4bZSE39HZLNj3pR2jdkjO91X04HwJqCEvk/Knd21QgjX76RNE49dv3WPmS6fS6eT5xepTbnWosN6SF8D5mh108xqFnED4ZSQKu9uo3VUIiQNgRBfz++IKybnNuUHUuPRNbMXPzGO8JXhED+FSO7ZiIbEXTwVaW+kY+HyKDCKEz14I0LhSNdV7GY2W3BQB2+0Odd0AkmcswuO/kcvFhBnjgr8aPQBHCbaNMwFuyBgHfZ3+OvSjcHv8lxJ8MxFHOurruk="
    - secure: "kVEgafI/tg0RVLZFAD2qSrUY3AzXGwHmMP7TEW+Ob2MtihkUDasxEA/VnFKi9F/xSYyrEdWK6EcQT2UDgI7EAH6Q2GKINUDyGuxa83DmPLAflGn0WCTD5mcImQawU1wydmxch+ndvjCkhYdjCLq0twWEyTxuAYUQrpQpIz3SSVHRgPDBAxn5xrDzR4EQczRqw2bPfQyKk8F+tKWieUeSrZPb/a7H2ixKCzJr24OPJAjULGDBvVWkO0tK7zlVhWC65Jq5zBtJZL7Ko6qYLeAcudlq81bhK4q2amRQOXyoSrTr43MDJ+XVUdayd5dTPJYsacXCz7IxXhCHxWiqmPUagqSZdOSXg9+mrj+YNyrXCK+zYgI4OXRIpgcTEjhkHKws1Z4ERPQkZkatPEhZAaVv4WN5d77HhoOM0TmxOe8rtboDmRtuAksXVyMG7kVXjhwmQR3pyYGHq9ZO05mufv+1JZMGSohIXa3BjU9Rq0w1578cnkUIOtyHAi/Aj16coLTPpDdewZwqK0bcNSoNZl7PinH1p+G1dxQV31eBABCBQXi4za3D9FMWnlH9cmHODB156r8eOnPKbRvbrrRCL+mS76q6ua2aO/WnhFhWT/P+EH3IF+3y8YJOBKYXj4C28/jV9TmlldUTI84/HleIsW8AGyifZjLs+AHr32tmMUXM8WM=" 

matrix:
  include:
    - os: linux
      env: RUSTUP_HOST=x86_64-unknown-linux-gnu
    - os: osx
      env: RUSTUP_HOST=x86_64-apple-darwin

install:
  - rustup self update
  - rustup set default-host $RUSTUP_HOST
  - rustup update $TRAVIS_RUST_VERSION
  - rustc -Vv

script:
  - test "${TRAVIS_SECURE_ENV_VARS}" = true && TEST_TARGET=all || TEST_TARGET=lib
  - cargo test --$TEST_TARGET --release
  - cargo test --$TEST_TARGET --release -- --ignored
  - cargo build --release
  - mv ./target/release/$TARGET ./

before_deploy:
  - tar --version
  - tar --help
  - cd $TRAVIS_BUILD_DIR/../
  - PROJECT="${TRAVIS_REPO_SLUG##*/}"
  - TAR=$TARGET-$TRAVIS_TAG-$RUSTUP_HOST.tar.gz
  - tar czvf $TAR $PROJECT/$TARGET $PROJECT/LICENSE $PROJECT/README.md
  - mv $TAR $TRAVIS_BUILD_DIR/
  - cd $TRAVIS_BUILD_DIR

deploy:
  api_key:
    secure: "f/bN0XER6uts/ncTIROxd7TQJ0/+5aID5T/puK6VNr1PPb/6RsckShYc7F3+Arm052E0AnnDnPuHttNCp4rDemS4tjSWgigc8AxKqzQDFbnVNSqKXND+aRHyGMbHMNRDa36/jl74/evQWw4dLKgoYFJ6PZq8qkEuT8sbyK4mXHn7izom3O3LYuH16dco1RCf/1OxiAXn2WjnAhCEZrEIJl1K53dXtXCVEreh6WP6TUp+q6gZqKiHU5IFwlDT0D1Y8FwiOgXGeHcHIzUEwjSlN9fj6NEiG5JkZ3YL364gkswSanUhq1zE9eazQc3Gpt9oz4+xClpB+rq3aS8bk07SySm71GNWNtEyPoTUaE9J6h3KlFLacbaCH4lWDiCt6/x/Jo3jxC8ypHyy4TtpQMas+cKM7OrUKo6BiqhoGoGj362ZJIq63jxJ40lHA25DrUUhzk+ab5me3biQiy6ujloPduIdFtII9R+sfOUXqADVw23Q/Dl2/ZmiEBs4vYz+kw1gvG/HSa93cp9r4VV4zZOMsgbonWTIhUOIniteJZYa0aAMiK7h5QvNKRhLX/vWJMQoWYbiFi7pnWw5yyvv71ycvHM3eGfpG4n4VZEbkkFLZmuG1t8dFYvEkkEfBUM0EFHqbBvoOEcs6D5kq1I2AS30XkbofiE2xmL/staHOHhYbYE="
  file: '*.tar.gz'
  file_glob: true
  skip_cleanup: true
  on:
    tags: true
  provider: releases

notifications:
  email:
    on_success: always

if: type = pull_request OR tag =~ ^v\d+\.\d+\.\d+.*$ # Beta feature
